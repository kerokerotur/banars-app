# 出欠登録 (Attendance Register)

## 目的
- メンバーが最小操作で出欠とコメントを登録できるようにし、回答率を高める。
- 締切後の変更は運営のみ可能とし、ダブルブッキングや無断欠席を防止する。

## フロー
1. イベント詳細画面の CTA からモーダルを開く。
2. `参加 / 不参加 / 保留` の 3 ボタンから選択し、任意コメントを入力。
3. `参加` を選ぶとポジション希望や集合可否など追加フィールドを表示。
4. 保存時に Supabase `attendance` テーブルへ `upsert`。

## バリデーション
- 締切 (`rsvp_deadline`) を過ぎている場合はメンバー書き込み不可、`manager` のみ上書き可。
- `参加` 時はコメントが空でも許容。ただし `不参加` を理由付きで依頼する KPI がある場合は必須化フラグをサーバー設定で制御。

## 技術ポイント
- フロントは `supabase_flutter` の `upsert` を利用し、既存回答がある場合は更新になるよう `member_id` + `event_id` のユニーク制約を設定。
- Edge Function `attendance_webhook` で Slack 通知を送る余地を残すため、`supabase_functions` の Webhook を有効化。

## 決定理由
- モーダルで完結する軽量 UI にすることで、他アプリ利用中のメンバーも即座に回答できる。
- 締切制御をサーバー側に置くことで、タイムゾーンやデバイス時計のずれによる不正確な締切判定を防げる。
